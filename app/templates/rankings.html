{% extends "base.html" %}

{% block title %}Rankings - Sports Betting Dashboard{% endblock %}

{% block content %}
<div class="bg-white shadow overflow-hidden sm:rounded-lg">
    <div class="px-4 py-5 sm:px-6">
        <h3 class="text-lg leading-6 font-medium text-gray-900">
            Ranked Opportunities
        </h3>
        <p class="mt-1 max-w-2xl text-sm text-gray-500">
            Bets ranked by composite score using our bell curve distribution system. Updates every 5 minutes.
        </p>
    </div>
    
    <div class="border-t border-gray-200">
        <div class="bg-gray-50 p-4">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for bet in ranked_bets %}
                <div class="bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden">
                    <!-- Header with Grade and Rank -->
                    <div class="flex justify-between items-center p-4 border-b border-gray-100">
                        <div class="flex items-center space-x-3">
                            <div class="flex-shrink-0">
                                <div class="w-16 h-16 rounded-full flex items-center justify-center
                                    {% if bet.grade.grade == 'A' %}bg-green-100 text-green-800
                                    {% elif bet.grade.grade == 'B' %}bg-blue-100 text-blue-800
                                    {% elif bet.grade.grade == 'C' %}bg-yellow-100 text-yellow-800
                                    {% elif bet.grade.grade == 'D' %}bg-orange-100 text-orange-800
                                    {% else %}bg-gray-100 text-gray-800{% endif %}">
                                    <span class="text-2xl font-bold">{{ bet.grade.grade }}</span>
                                </div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500">Score</div>
                                <div class="text-sm font-medium">{{ "%.1f"|format(bet.grade.composite_score) if bet.grade.composite_score else 'N/A' }}%</div>
                            </div>
                        </div>
                        <div class="text-sm font-medium text-gray-500">
                            Rank #{{ loop.index }}
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="p-4 space-y-4">
                        <!-- Primary Info -->
                        <div>
                            {% if bet.participant and bet.participant != "None" %}
                            <div class="text-lg font-semibold text-gray-900">{{ bet.participant }}</div>
                            {% endif %}
                            <div class="text-base font-medium text-gray-800">
                                {{ bet.bet_type or "Unknown" }}{% if bet.bet_line and bet.bet_line != "None" %} - {{ bet.bet_line }}{% endif %}
                            </div>
                            <div class="text-sm text-gray-600 mt-1">
                                {% if bet.home_team and bet.away_team %}
                                    {{ bet.home_team }} vs {{ bet.away_team }}
                                {% elif bet.event_teams %}
                                    {{ bet.event_teams }}
                                {% endif %}
                            </div>
                        </div>

                        <!-- Stats Grid -->
                        <div class="grid grid-cols-2 gap-4 py-2">
                            <!-- Current EV -->
                            <div>
                                <div class="text-xs font-medium text-gray-500">Current EV</div>
                                <div class="mt-1">
                                    <span class="px-2 py-1 text-sm font-semibold rounded-full
                                        {% if bet.ev_percent >= 10 %}bg-green-100 text-green-800
                                        {% elif bet.ev_percent >= 5 %}bg-blue-100 text-blue-800
                                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                                        {{ "%.2f"|format(bet.ev_percent) if bet.ev_percent else "N/A" }}%
                                    </span>
                                </div>
                            </div>

                            <!-- Sportsbook -->
                            <div>
                                <div class="text-xs font-medium text-gray-500">Sportsbook</div>
                                <div class="text-sm font-semibold text-gray-900">{{ bet.sportsbook or "Unknown" }}</div>
                            </div>

                            {% if bet.grade and bet.grade.bayesian_confidence is not none %}
                            <!-- Confidence -->
                            <div>
                                <div class="text-xs font-medium text-gray-500">Confidence</div>
                                <div class="mt-1">
                                    <span class="px-2 py-1 text-sm font-semibold rounded-full
                                        {% if bet.grade.bayesian_confidence >= 80 %}bg-green-100 text-green-800
                                        {% elif bet.grade.bayesian_confidence >= 60 %}bg-blue-100 text-blue-800
                                        {% elif bet.grade.bayesian_confidence >= 40 %}bg-yellow-100 text-yellow-800
                                        {% else %}bg-red-100 text-red-800{% endif %}">
                                        {{ "%.1f"|format(bet.grade.bayesian_confidence) }}%
                                    </span>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Time Left -->
                            <div>
                                <div class="text-xs font-medium text-gray-500">Time Left</div>
                                <div class="mt-1">
                                    {% if bet.event_time and now is defined %}
                                        <span class="px-2 py-1 text-sm font-semibold rounded-full
                                            {% if bet.event_time is not string %}
                                                {% set time_diff = (bet.event_time - now).total_seconds() %}
                                                {% if time_diff > 43200 %}bg-green-100 text-green-800
                                                {% elif time_diff > 21600 %}bg-blue-100 text-blue-800
                                                {% elif time_diff > 10800 %}bg-yellow-100 text-yellow-800
                                                {% elif time_diff > 3600 %}bg-orange-100 text-orange-800
                                                {% elif time_diff > 0 %}bg-red-100 text-red-800
                                                {% else %}bg-gray-100 text-gray-800{% endif %}
                                            {% else %}
                                                bg-gray-100 text-gray-800
                                            {% endif %}">
                                            {% if bet.event_time is not string %}
                                                {% set time_diff = (bet.event_time - now).total_seconds() %}
                                                {% if time_diff > 86400 %}
                                                    {{ (time_diff / 86400)|int }}d
                                                {% elif time_diff > 3600 %}
                                                    {{ (time_diff / 3600)|int }}h
                                                {% elif time_diff > 60 %}
                                                    {{ (time_diff / 60)|int }}m
                                                {% elif time_diff > 0 %}
                                                    Soon
                                                {% else %}
                                                    Live
                                                {% endif %}
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Footer Info -->
                        <div class="pt-2 border-t border-gray-100">
                            <div class="flex justify-between items-center text-xs text-gray-500">
                                <div>{{ bet.sport_league or "Unknown" }}</div>
                                {% if bet.grade and bet.grade.ev_change is not none %}
                                <div>
                                    <span class="px-2 py-1 rounded-full
                                        {% if bet.grade.ev_change > 0 %}bg-green-50 text-green-700
                                        {% elif bet.grade.ev_change < 0 %}bg-red-50 text-red-700
                                        {% else %}bg-gray-50 text-gray-700{% endif %}">
                                        EV {{ '%+.2f'|format(bet.grade.ev_change) }}%
                                    </span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
.hover\:shadow-md:hover {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}
</style>
{% endblock %}
